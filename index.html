<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로젝트</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <h1>프로젝트</h1>
    <ul id="basketList">
        <li>
            <div>
                <img src="./img/우유.jpeg" alt="우유 2.3L">
            </div>
            <form name="a" action="#" class="basketForm">
                <h4>
                    더조은컴퓨터 우유 2.3L
                </h4>
                <p><span>4800</span>원</p>
                <p>
                    <label>
                        수량:
                        <select name="cnt">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </label>
                </p>
                <p>
                    <input type="hidden" name="num" value="1">
                    <input type="hidden" name="title" value="더조은컴퓨터 우유 2.3L">
                    <input type="hidden" name="price" value="4800">
                    <button type="submit">장바구니</button>
                    <button type="button">바로구매</button>
                </p>
            </form>
        </li>
        <li>
            <div>
                <img src="./img/그릴리.jpg" alt="직화 후랑크 오리지널 250g 2개입" style="width: 150px;">
            </div>
            <form name="b" action="#" class="basketForm">
                <h4>
                    직화 후랑크 오리지널 250g 2개입
                </h4>
                <p><span>6980</span>원</p>
                <p>
                    <label>
                        수량:
                        <select name="cnt">
                            <option value="2">1</option>
                            <option value="4">2</option>
                            <option value="6">3</option>
                            <option value="8">4</option>
                            <option value="10">5</option>
                        </select>
                    </label>
                </p>
                <p>
                    <input type="hidden" name="num" value="2">
                    <input type="hidden" name="title" value="직화 후랑크 오리지널 250g 2개입" style="width: 150px;">
                    <input type="hidden" name="price" value="6980">
                    <button type="submit">장바구니</button>
                    <button type="button">바로구매</button>
                </p>
            </form>
        </li>
        <li>
            <div>
                <img src="./img/불닭볶음면.jpg" alt="불닭볶음면 140g 5개입" style="width: 150px;" >
            </div>
            <form name="c" action="#" class="basketForm">
                <h4>
                    불닭볶음면 140g 5개입
                </h4>
                <p><span>4950</span>원</p>
                <p>
                    <label>
                        수량:
                        <select name="cnt">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </label>
                </p>
                <p>
                    <input type="hidden" name="num" value="3">
                    <input type="hidden" name="title" value="불닭볶음면 140g 5개입">
                    <input type="hidden" name="price" value="4950">
                    <button type="submit">장바구니</button>
                    <button type="button">바로구매</button>
                </p>
            </form>
        </li>
        <li>
            <div>
                <img src="./img/호빵.jpg" alt="삼립호빵 4개입" style="width: 150px;">
            </div>
            <form name="d" action="#" class="basketForm">
                <h4>
                    삼립호빵 4개입
                </h4>
                <p><span>5400</span>원</p>
                <p>
                    <label>
                        수량:
                        <select name="cnt">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </label>
                </p>
                <p>
                    <input type="hidden" name="num" value="4">
                    <input type="hidden" name="title" value="삼립호빵 4개입">
                    <input type="hidden" name="price" value="5400">
                    <button type="submit">장바구니</button>
                    <button type="button">바로구매</button>
                </p>
            </form>
        </li>
        <li>
            <div>
                <img src="./img/씨앗호떡.jpg" alt="씨앗호떡믹스 360g" style="width: 150px;">
            </div>
            <form name="e" action="#" class="basketForm">
                <h4>
                    씨앗호떡믹스 360g
                </h4>
                <p><span>6790</span>원</p>
                <p>
                    <label>
                        수량:
                        <select name="cnt">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </label>
                </p>
                <p>
                    <input type="hidden" name="num" value="5">
                    <input type="hidden" name="title" value="씨앗호떡믹스 360g">
                    <input type="hidden" name="price" value="6790">
                    <button type="submit">장바구니</button>
                    <button type="button">바로구매</button>
                </p>
            </form>
        </li>
        <li>
            <div>
                <img src="./img/치즈.jpeg" alt="레지아노치즈" style="width:150px;">
            </div>
            <form name="e" action="#" class="basketForm">
                <h4>
                    레지아노치즈
                </h4>
                <p><span>12000</span>원</p>
                <p>
                    <label>
                        수량:
                        <select name="cnt">
                            <option value="1">1</option>
                            <option value="2" selected>2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </label>
                </p>
                <p>
                    <input type="hidden" name="num" value="6">
                    <input type="hidden" name="title" value="레지아노치즈">
                    <input type="hidden" name="price" value="12000">
                    <button type="submit">장바구니</button>
                    <button type="button">바로구매</button>
                </p>
            </form>
        </li>
    </ul>
    <div id="selectedList">
        <h4>
            장바구니 목록
            <button id="moveSelectedList">접기</button>
        </h4>
        <table id="resultTable">
            <thead>
                <tr>
                    <th>이름</th>
                    <th>가격</th>
                    <th>수량</th>
                    <th>총가격</th>
                    <th>삭제</th>
                </tr>
            </thead>
            <tbody id="basketCont">
                <tr id="trEx">
                    <td>
                        <b class="title"></b>
                    </td>
                    <td class="price"></td>
                    <td class="cnt"></td>
                    <td class="total"></td>
                    <td>
                         <button class="delBasket" data-num="">상품삭제</button>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="6">전체가격 : 
                        <b id="totalPrice">0</b>
                    </td>
                </tr>
            </tfoot>
        </table>
        <p>
            <button id="printBasketsBtn">장바구니 출력</button>
        </p>
    </div>
    <script>
        const basketCont=document.getElementById("basketCont");
        const trEx=document.getElementById("trEx");
        const totalPrice=document.getElementById("totalPrice");
        const printBasketsBtn=document.getElementById("printBasketsBtn");
        const basketFormArr=document.querySelectorAll(".basketForm");

        const baskets={
            2 : { num:2, title:"레지아노치즈",cnt:4, price:12000, total:48000 },
            4 : { num:4, title:"통마늘 600g",cnt:2, price: 6000, total:12000 },
            6 : { num:6, title:"프레지덩 버터 450g", cnt:5, price: 9900, total:49500 },
            total : 109500
        };
        
        baskets.setBasket=function(basket){
            if(basket.num in this){
                this.total-=this[basket.num].total;
            }
            this[basket.num]=basket;
            this.total+=basket.total;
        }
        baskets.delBasket=function(num){
            this.total-=this[num].total;
            delete baskets[num];
        }
        class Basket{
            constructor(form){
                this.num=Number(form.num.value);
                this.title=form.title.value;
                this.cnt=Number(form.cnt.value);
                this.price=Number(form.price.value);
                this.total=this.cnt*this.price;
            }
        }

        const printBaskets=()=>{
            basketCont.innerHTML="";
            for(let key in baskets){
                if(key === "total"){
                    let total=document.createTextNode(baskets[key]);
                    totalPrice.replaceChildren(total);
                }else if(!isNaN(key)){ 
                    let tr=trEx.cloneNode(true);
                    tr.removeAttribute("id");
                    tr.querySelector(".title").innerText=baskets[key].title;
                    tr.querySelector(".price").innerText=baskets[key].price;
                    tr.querySelector(".cnt").innerText=baskets[key].cnt;
                    tr.querySelector(".total").innerText=baskets[key].cnt*baskets[key].price;
                    tr.querySelector(".delBasket").dataset.num=baskets[key].num;
                    basketCont.append(tr);
                    tr.querySelector(".delBasket").onclick=(e)=>{
                        
                        baskets.delBasket(Number(e.target.dataset.num))
                        printBaskets();  
                    }
                }
            }
        }        
        const basketFormSubmitHandler=(e)=>{
            e.preventDefault();
            let b=new Basket(e.target);
            
            baskets.setBasket(b);
            printBaskets();
        }
        basketFormArr.forEach((form)=>{
            form.onsubmit=basketFormSubmitHandler;
        })
        
        printBasketsBtn.onclick=printBaskets;
    </script>
</body>
</html>